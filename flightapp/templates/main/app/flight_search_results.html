<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Adventure - Free Bootstrap 4 Template by Colorlib</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    
    <link href="https://fonts.googleapis.com/css?family=Poppins:200,300,400,500,600,700" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Abril+Fatface" rel="stylesheet">

    <link rel="stylesheet" href="css/open-iconic-bootstrap.min.css">
    <link rel="stylesheet" href="css/animate.css">
    
    <link rel="stylesheet" href="css/owl.carousel.min.css">
    <link rel="stylesheet" href="css/owl.theme.default.min.css">
    <link rel="stylesheet" href="css/magnific-popup.css">

    <link rel="stylesheet" href="css/aos.css">

    <link rel="stylesheet" href="css/ionicons.min.css">

    <link rel="stylesheet" href="css/bootstrap-datepicker.css">
    <link rel="stylesheet" href="css/jquery.timepicker.css">

    
    <link rel="stylesheet" href="css/flaticon.css">
    <link rel="stylesheet" href="css/icomoon.css">
    <link rel="stylesheet" href="css/style.css">
  </head>
  <body>
    
	  <nav class="navbar navbar-expand-lg navbar-dark ftco_navbar bg-dark ftco-navbar-light" id="ftco-navbar">
	    <div class="container">
	      <a class="navbar-brand" href="index.html">Fly Like T6</a>
	      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#ftco-nav" aria-controls="ftco-nav" aria-expanded="false" aria-label="Toggle navigation">
	        <span class="oi oi-menu"></span> Menu
	      </button>

	      <div class="collapse navbar-collapse" id="ftco-nav">
	        <ul class="navbar-nav ml-auto">
				<li class="nav-item"><a href="about.html" class="nav-link" style="color:black">About</a></li>
				<li class="nav-item"><a href="index.html" class="nav-link" style="color:black">Search Flights</a></li>
				<li class="nav-item"><a href="manage_booking.html" class="nav-link" style="color:black">My Bookings</a></li>
				<li class="nav-item"><a href="about.html" class="nav-link" style="color:black">Logout</a></li>
	        </ul>
	      </div>
	    </div>
	  </nav>
    <!-- END nav -->
		
		<section class="ftco-section ftco-degree-bg">
      <div class="container">
        <div class="row">
        	<div class="col-lg-3 sidebar">
        		<div class="sidebar-wrap ftco-animate">
        			<h3 class="heading mb-4">Find Flight</h3>
        			<form action="#"  id='searchFlightForm'>
        				<div class="fields">
		              <div class="form-group">
		                <input type="text" class="form-control" placeholder="From" id='arrivalDest'>
		              </div>
					  
					  <div class="form-group">
		                <input type="text" class="form-control" placeholder="To" id='departDest'>
		              </div>

		              <!-- <div class="form-group">
		                <input type="datetime" id="checkin_date" class="form-control" placeholder="Arrival Time" id='deptTime'>
		              </div>
		              <div class="form-group">
		                <input type="datetime" id="checkin_date" class="form-control" placeholder="Departure Time" id='arrivalTime'>
					  </div> -->
					  <div class="form-group">
		                <div class="select-wrap one-third">
	                    <div class="icon"><span class="ion-ios-arrow-down"></span></div>
	                    <select name="" id="class_name" class="form-control" placeholder="Keyword search">
	                      <option value="">Select Class</option>
	                      <option value="economy">Economy</option>
	                      <option value="business">Business</option>
	                      <option value="first">First Class</option>
	                    </select>
	                  </div>
					  </div>
					  
					  <div class="form-group">
		                <div class="select-wrap one-third">
	                    <div class="icon"><span class="ion-ios-arrow-down"></span></div>
	                    <select name="" id="flight_length" class="form-control" placeholder="Keyword search">
	                      <option value="">Select Flight Length</option>
	                      <option value="long">Long</option>
	                      <option value="short">Short</option>
	                    </select>
	                  </div>
		              </div>

		              <div class="form-group">
		                <input type="submit" value="Search" class="btn btn-primary py-3 px-5">
		              </div>
		            </div>
	            </form>
        		</div>
        		<div class="sidebar-wrap ftco-animate">

        		</div>
		  </div>
		  
          <!-- <div class="col-lg-9">
          		<div class="col-md-12 hotel-single ftco-animate mb-5 mt-4">
          			<h4 class="mb-4">1. Singapore to Japan</h4>
          			<div class="row">
          				<div class="col-md-12">
				    				<div class="destination">
				    					<div class="text p-3">
				    						<div class="d-flex">
				    							<div class="one">
						    						<h3>SIN 22:25&nbsp &nbsp → &nbsp&nbsp JAP 17:25</h3>
					    						</div>
					    						<div class="two">
													<small>From SGD</small>
					    							<span class="price per-price">$2650.70<br></span>
				    							</div>
				    						</div>
											<p>Departure Date: 20 Mar (Fri) Arrival Date: 21 Mar (Sat)</p>
				    						<hr>
				    						<p class="bottom-area d-flex">
				    							<span><i class="icon-map-o"></i> Singapore Airlines • SQ 285</span> 
				    							<span class="ml-auto"><a href="#">Book Now</a></span>
				    						</p>
				    					</div>
				    				</div>
								</div>
								
								<div class="col-md-12 hotel-single ftco-animate mb-5 mt-4">
									<h4 class="mb-4">2. Japan to Singapore</h4>
									<div class="row">
										<div class="col-md-12">
												  <div class="destination">
													  <div class="text p-3">
														  <div class="d-flex">
															  <div class="one">
																  <h3>SIN 09:15&nbsp &nbsp → &nbsp&nbsp JAP 21:00</h3>
																  
															  </div>
															  <div class="two">
																  <small>From SGD</small>
																  <span class="price per-price">+$0<br></span>
															  </div>
														  </div>
														  <p>Departure Date: 16 Apr (Fri) Arrival Date: 16 Apr (Sat)</p>
														  <hr>
														  <p class="bottom-area d-flex">
															  <span><i class="icon-map-o"></i> Singapore Airlines • SQ 4388</span> 
															  <span class="ml-auto"><a href="#">Book Now</a></span>
														  </p>
													  </div>
												  </div>
											  </div> -->
				<form action="#"  id='searchFlightForm'>    			
          		<div class="col-md-12 hotel-single ftco-animate mb-5 mt-4">
					<h4 class="mb-5">Select your flights</h4>
					<table id="flightsTable" class='table table-striped' id='book-list' border='1'>
						<thead>
							<th>Flight Number</th>
							<th>Departure Destination</th>
							<th>Arrival Destination</th>
							<th>Departure Time</th>
							<th>Arrival Time</th>
							<th>Base Price</th>
							<th>Flight Type</th>
						</thead>
						
					</table>

					

          			<h4 class="mb-5">Select your add-ons</h4>
          			<div class="fields">
          				<div class="row">
          					
				            <div class="col-md-6">
					            <div class="form-group">
				                <div class="select-wrap one-third">
			                    <div class="icon"><span class="ion-ios-arrow-down"></span></div>
			                    <select name="" id="" class="form-control" placeholder="In-Fligt Meal">
			                      <option value="0">In-Flight Meal</option>
			                      <option value="1">Chinese</option>
			                      <option value="2">Indian</option>
			                      <option value="3">Malay</option>
								  <option value="4">Western</option>
								  <option value="4">Japanese</option>
			                    </select>
			                  </div>
				              </div>
			              </div>
			              <div class="col-md-6">
					            <div class="form-group">
				                <div class="select-wrap one-third">
			                    <div class="icon"><span class="ion-ios-arrow-down"></span></div>
			                    <select name="" id="" class="form-control" placeholder="Baggage">
			                      <option value="0">Baggage</option>
			                      <option value="1">10kg<option>
			                      <option value="2">20kg</option>
			                      <option value="3">30kg</option>
			                      <option value="4">40kg</option>
			                    </select>
			                  </div>
				              </div>
			              </div>
				            <div class="col-md-12">
				              <div class="form-group">
				                <input type="submit" value="Proceed to Checkout" class="btn btn-primary py-3">
				              </div>
			              </div>
		              </div>
		            </div>
				  </div>

            <p><!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
  Copyright &copy;<script>document.write(new Date().getFullYear());</script> All rights reserved | This template is made with <i class="icon-heart" aria-hidden="true"></i> by <a href="https://colorlib.com" target="_blank">Colorlib</a>
  <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. --></p>
          </div>
        </div>
      </div>
    </footer>
    
  

  <!-- loader -->
  <div id="ftco-loader" class="show fullscreen"><svg class="circular" width="48px" height="48px"><circle class="path-bg" cx="24" cy="24" r="22" fill="none" stroke-width="4" stroke="#eeeeee"/><circle class="path" cx="24" cy="24" r="22" fill="none" stroke-width="4" stroke-miterlimit="10" stroke="#F96D00"/></svg></div>

  
  <script src="js/jquery.min.js"></script>
  <script src="js/jquery-migrate-3.0.1.min.js"></script>
  <script src="js/popper.min.js"></script>
  <script src="js/bootstrap.min.js"></script>
  <script src="js/jquery.easing.1.3.js"></script>
  <script src="js/jquery.waypoints.min.js"></script>
  <script src="js/jquery.stellar.min.js"></script>
  <script src="js/owl.carousel.min.js"></script>
  <script src="js/jquery.magnific-popup.min.js"></script>
  <script src="js/aos.js"></script>
  <script src="js/jquery.animateNumber.min.js"></script>
  <script src="js/bootstrap-datepicker.js"></script>
  <!-- <script src="js/jquery.timepicker.min.js"></script> -->
  <script src="js/scrollax.min.js"></script>
  <!-- <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBVWaKrjvy3MaE7SQ74_uJiULgl1JY0H2s&sensor=false"></script>
  <script src="js/google-map.js"></script> -->
  <script src="js/main.js"></script>

  <!-- Get flight details with arrival and departure destination -->
  <script>
    // Helper function to display error message
    function showError(message) {
        // Display an error under the the predefined label with error as the id
        $('#error').text(message);
    }

    $("#searchFlightForm").submit(async (event) => {
        //Prevents screen from refreshing when submitting
        event.preventDefault();

        var flightURL = "http://127.0.0.1:5001/flight/";
		var pricingURL = "http://127.0.0.1:5003/pricing/class/";
        // var homeURL = "http://127.0.0.1/bookstore/";

        //Get form data 
        var arrivalDest = $('#arrivalDest').val();
        var departDest = $('#departDest').val();
		// var deptTime = $('#deptTime').val();
		// var arrivalTime = $('#arrivalTime').val();
		var class_name = document.getElementById("class_name").value;
		var flight_length = document.getElementById("flight_length").value;

		flightURL_dep = flightURL + departDest + '/' + arrivalDest;
		flightURL_ret = flightURL + arrivalDest + '/' + departDest;
		pricingURL = pricingURL + flight_length + '_' + class_name;

		try {
			// get flight details of departure flight
                const response_dep =
                    await fetch(
                        flightURL_dep, { method: 'GET' }
                    );
                const data_dep = await response_dep.json();
				console.log(data_dep);
				var flights = data_dep.flight;
                if (response_dep.ok) {
					var rows = "";
                    for (const flight of flights) {
                        eachRow =
                            "<td>" + flight.flightNo + "</td>" +
                            "<td>" + flight.departDest + "</td>" +
                            "<td>" + flight.arrivalDest + "</td>" +
                            "<td>" + flight.deptTime + "</td>" +
							"<td>" + flight.arrivalTime + "</td>" +
							"<td>" + flight.basePrice + "</td>"+
							"<td>" + flight.type + "</td>";
                        rows += "<tbody><tr>" + eachRow + "</tr></tbody>";
                    }
					console.log(rows)
					
				$('#flightsTable').append(eachrow);
                } else {
                    showError(data_dep.message);
                }

				// get flight details of return flight
				const response_ret =
                    await fetch(
                        flightURL_ret, { method: 'GET' }
                    );
                const data_ret = await response_ret.json();
                if (response_ret.ok) {
                    // console.log(data_ret)
                } else {
                    showError(data_ret.message);
                }

				// get flight class type percentage
				const response_price =
                    await fetch(
                        pricingURL, { method: 'GET' }
                    );
                const data_price = await response_price.json();
                if (response_price.ok) {
                    // console.log(data_price);
                } else {
                    showError(data_price.message);
                }


            } catch (error) {
                // Errors when calling the service; such as network error, 
                // service offline, etc
                showError
                    ('There is a problem retrieving books data, please try again later.<br />' + error);

            }

    });
</script>
    
  </body>
</html>